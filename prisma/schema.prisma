// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

model Tester {
  id Int @id @default(autoincrement())
}

model User {
  id        Int        @id @default(autoincrement())
  name      String
  email     String     @unique
  password  String?
  phone     String?
  address   String?
  avatar    String?    @default("https://www.svgrepo.com/show/452030/avatar-default.svg")
  verify    Boolean    @default(false)
  userRoles UserRole[]
  carts     Cart?
  orders    Order[]
  createdAt DateTime   @default(now())
}

//Mot nguoi dung co nhieu gio hang, userID, productID, id, userID , userId
model Cart {
  id           Int           @id @default(autoincrement())
  userID       Int           @unique
  user         User          @relation(fields: [userID], references: [id])
  cartProducts CartProduct[]
}

model CartProduct {
  id               Int            @id @default(autoincrement())
  quantity         Int            @default(1)
  cart             Cart           @relation(fields: [cartID], references: [id])
  cartID           Int
  productVariant   ProductVariant @relation(fields: [productVariantID], references: [id])
  productVariantID Int

  @@unique([cartID, productVariantID])
}

model Product {
  id              Int              @id @default(autoincrement())
  name            String
  description     String
  price           Decimal
  active          Boolean
  thumbnail       Json
  brand           Brand            @relation(fields: [brandID], references: [id])
  brandID         Int
  productVariants ProductVariant[]
  //category String ["trending","popular","freeship"], discount 
  category        Json
  discount        Decimal //Chinh lai thanh default(0), nho chinh lai 
}

model Order {
  id              Int         @id @default(autoincrement())
  user            User        @relation(fields: [userID], references: [id])
  userID          Int
  status          String
  orderItems      OrderItem[]
  shippingAddress String
  createdAt       DateTime
  payments        Payment?
}

model Payment {
  id            Int    @id @default(autoincrement())
  paymentMethod String
  order         Order  @relation(fields: [orderID], references: [id])
  orderID       Int    @unique
}

model OrderItem {
  id               Int            @id @default(autoincrement())
  quantity         Int
  price            Decimal
  productVariant   ProductVariant @relation(fields: [productVariantID], references: [id])
  productVariantID Int //Fix lai thanh product 
  order            Order          @relation(fields: [orderID], references: [id])
  orderID          Int
}

model ProductVariant {
  id           Int           @id @default(autoincrement())
  product      Product       @relation(fields: [productID], references: [id])
  productID    Int
  color        Color         @relation(fields: [colorID], references: [id])
  colorID      Int
  quantity     Int
  orderItems   OrderItem[] //LowPrice (true/False) , Freeship (True/False) , BestSold(True/False)prod
  size         Int           @default(0)
  cartProducts CartProduct[]

  @@unique([productID, size, colorID])
}

model Brand {
  id       Int       @id @default(autoincrement())
  name     String
  products Product[]
}

model Color {
  id              Int              @id @default(autoincrement())
  name            String
  hex             String
  productVariants ProductVariant[]
}

model Role {
  id        Int        @id
  role      String
  userRoles UserRole[]
}

model UserRole {
  userID Int
  roleID Int
  user   User @relation(fields: [userID], references: [id])
  role   Role @relation(fields: [roleID], references: [id])

  @@id([userID, roleID])
}

//Sua full endpoint register  verify user theo database roi code tiep 
//Token se chua thong tin xac thuc gom: userID , email (OK) 
//Fix bang role : prisma seed data , userROle 
